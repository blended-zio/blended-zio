(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{123:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),d=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=d(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},p=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=d(n),p=r,h=u["".concat(i,".").concat(p)]||u[p]||b[p]||o;return n?a.a.createElement(h,c(c({ref:t},l),{},{components:n})):a.a.createElement(h,c({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},73:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return d}));var r=n(3),a=n(7),o=(n(0),n(123)),i={slug:"doc-helpers",title:"Documentation Helpers",tags:["Remark","Docusaurus 2"],author:"Andreas Gies",author_url:"https://github.com/atooni"},c={permalink:"/blended-zio/blog/doc-helpers",source:"@site/blog/2021-02-15-Docusaurus.md",description:"Blended ZIO uses Docusaurus 2 as a generator to produce the static web site from markdown documents. This blog post shows some add-ons we are using to increase the quality of our web site.",date:"2021-02-15T00:00:00.000Z",tags:[{label:"Remark",permalink:"/blended-zio/blog/tags/remark"},{label:"Docusaurus 2",permalink:"/blended-zio/blog/tags/docusaurus-2"}],title:"Documentation Helpers",truncated:!0,nextItem:{title:"Integration Testing",permalink:"/blended-zio/blog/integration-testing"}},s=[{value:"Additional tools",id:"additional-tools",children:[{value:"Scala MDoc",id:"scala-mdoc",children:[]},{value:"Code include plugin",id:"code-include-plugin",children:[]},{value:"Text to Image generator",id:"text-to-image-generator",children:[]}]},{value:"Overall processing",id:"overall-processing",children:[{value:"Project layout",id:"project-layout",children:[]},{value:"Site generation",id:"site-generation",children:[]}]},{value:"Working on the documentation",id:"working-on-the-documentation",children:[{value:"Start mdoc",id:"start-mdoc",children:[]},{value:"Start the docusaurus test server",id:"start-the-docusaurus-test-server",children:[]}]}],l={toc:s};function d(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("em",{parentName:"p"},"Blended ZIO")," uses ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://v2.docusaurus.io/"}),"Docusaurus 2")," as a generator to produce the static web site from markdown documents. This blog post shows some add-ons we are using to increase the quality of our web site. "),Object(o.b)("p",null,"At the core the website is a collection of markdown documents that are translated to static HTML, which can be hosted on any web server, in our case github pages. ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://v2.docusaurus.io/"}),"Docusaurus 2")," uses ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/gnab/remark"}),"Remark.js")," under the covers, which gives the user the option to rely on additional remark plugins in the rendering process. "),Object(o.b)("h2",{id:"additional-tools"},"Additional tools"),Object(o.b)("h3",{id:"scala-mdoc"},"Scala MDoc"),Object(o.b)("p",null,Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://scalameta.org/mdoc/"}),"Scala mdoc")," can be used to run Scala codeblocks through the compiler to ensure that the code examples given in the documentation do compile. Furthermore,\nit provides the option to amend the code block by inserting commented lines with REPL output. "),Object(o.b)("p",null,"Mdoc is applied by the sbt mdoc plugin and creates a copy of the markdown files used as input with the Scala code blocks changed according to the mdoc processing rules. "),Object(o.b)("p",null,"The resulting output is then run though Remark to produce the final HTML. "),Object(o.b)("h3",{id:"code-include-plugin"},"Code include plugin"),Object(o.b)("p",null,"In many cases we want to reference code either from within our own project or from a URL. Within ",Object(o.b)("em",{parentName:"p"},"Blended ZIO")," we are using the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.npmjs.com/package/blended-include-code-plugin"}),"Include Code Plugin")," which allows us to copy code blocks from the file system of from URLs into our documentation. "),Object(o.b)("h3",{id:"text-to-image-generator"},"Text to Image generator"),Object(o.b)("p",null,"Within the documentation we often have the requirement to produce technical images such as graph visualizations, flow charts, sequence diagrams etc. Rather than using a dedicated graphics program, we prefer to create the images from a textual description. There are many generators that support that. "),Object(o.b)("p",null,"The fantastic ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://kroki.io/"}),"Kroki Web Service")," provides a unified web service as a common interface to many generators that can create images from various specialised DSL's. "),Object(o.b)("p",null,"The ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.npmjs.com/package/remark-kroki-plugin"}),"Kroki Image Plugin")," is used within ",Object(o.b)("em",{parentName:"p"},"Blended ZIO")," to execute the Kroki web service for code blocks having ",Object(o.b)("inlineCode",{parentName:"p"},"kroki")," as their language. "),Object(o.b)("h2",{id:"overall-processing"},"Overall processing"),Object(o.b)("h3",{id:"project-layout"},"Project layout"),Object(o.b)("p",null,"The project documentation is located within the ",Object(o.b)("inlineCode",{parentName:"p"},"docs")," directory of the projects. All markdown files from this directory will be preprocessed by Scala Mdoc. "),Object(o.b)("p",null,"Everything related to the web site is located within the ",Object(o.b)("inlineCode",{parentName:"p"},"website")," directory. The markdown files within ",Object(o.b)("inlineCode",{parentName:"p"},"website\\blog")," will not be run through Scala Mdoc. "),Object(o.b)("h3",{id:"site-generation"},"Site generation"),Object(o.b)("p",null,"First, the content of ",Object(o.b)("inlineCode",{parentName:"p"},"docs")," is run through Scala Mdoc. This will produce a modified copy of the markdown files in ",Object(o.b)("inlineCode",{parentName:"p"},"website/docs"),". Together with the markdown documents in ",Object(o.b)("inlineCode",{parentName:"p"},"website/blog")," this will be the primary input to the site generator. "),Object(o.b)("p",null,"The markdown input will be run though the chain of Remark processors, the last of which will actually generate the HTML pages. We have configured the plugins above into our Docusaurus 2 config file as below:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript",metastring:'title="docusaurus.config.js"',title:'"docusaurus.config.js"'}),"  presets: [\n    [\n      '@docusaurus/preset-classic',\n      {\n        docs: {\n          sidebarPath: require.resolve('./sidebars.js'),\n          remarkPlugins: [\n            [require('blended-include-code-plugin'), { marker: 'CODE_INCLUDE' }],\n            [require('remark-kroki-plugin'), { krokiBase: 'https://kroki.io', lang: \"kroki\", imgRefDir: \"/img/kroki\", imgDir: \"static/img/kroki\" }]\n          ],\n        },\n        blog: {\n          showReadingTime: false,\n          remarkPlugins: [\n            [require('blended-include-code-plugin'), { marker: 'CODE_INCLUDE' }],\n            [require('remark-kroki-plugin'), { krokiBase: 'https://kroki.io', lang: \"kroki\", imgRefDir: \"/img/kroki\", imgDir: \"static/img/kroki\" }]\n          ],\n        },\n        theme: {\n          customCss: [\n            require.resolve('./src/css/custom.css'),\n            //require.resolve('./node_modules/prism-themes/themes/prism-cb.css')\n          ],\n        },\n      },\n    ],\n  ],\n")),Object(o.b)("p",null,"The image below has been generated using ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://mermaid-js.github.io/mermaid/#/"}),"mermaid")," and depicts the overall site generation."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/kroki/521282776b33034e284ff6d3a4accda8.svg",alt:"521282776b33034e284ff6d3a4accda8"}))),Object(o.b)("h2",{id:"working-on-the-documentation"},"Working on the documentation"),Object(o.b)("p",null,"To work on the documentation locally, it is best to run two terminal windows to execute the individual parts of the generator chain:"),Object(o.b)("h3",{id:"start-mdoc"},"Start mdoc"),Object(o.b)("p",null,"In the first terminal, navigate to the project's checkout directory and start a ",Object(o.b)("inlineCode",{parentName:"p"},"sbt")," shell. "),Object(o.b)("p",null,"Within the sbt shell, execute "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"docs/mdoc --watch\n")),Object(o.b)("p",null,"This will monitor the docs directory and execute the mdoc preprocessor whenever a change in one of the markdown documents is detected. "),Object(o.b)("h3",{id:"start-the-docusaurus-test-server"},"Start the docusaurus test server"),Object(o.b)("p",null,"In the second terminal, navigate to the ",Object(o.b)("inlineCode",{parentName:"p"},"website")," directory and "),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"For the first start, run ",Object(o.b)("inlineCode",{parentName:"li"},"npm install")),Object(o.b)("li",{parentName:"ol"},"Otherwise, just run ",Object(o.b)("inlineCode",{parentName:"li"},"yarn start"))),Object(o.b)("p",null,"This will start a local web server on port 3000, so that the documentation can be viewed at http://localhost:3000/blended-zio. Now, when changes to one of the markdown files\nin ",Object(o.b)("inlineCode",{parentName:"p"},"docs")," or ",Object(o.b)("inlineCode",{parentName:"p"},"website/blog")," are made and saved, the website will update automatically within the browser. "),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Without running the mdoc preprocessor, the changes to the markdown files in ",Object(o.b)("inlineCode",{parentName:"p"},"doc")," will not trigger an update to the generated site. "))))}d.isMDXComponent=!0}}]);