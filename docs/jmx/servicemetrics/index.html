<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blended-zio/blog/rss.xml" title="Blended ZIO Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blended-zio/blog/atom.xml" title="Blended ZIO Blog Atom Feed"><title data-react-helmet="true">Service Metrics | Blended ZIO</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Service Metrics | Blended ZIO"><meta data-react-helmet="true" name="description" content="The implementation of the ZIO version starts with defining an interface that resembles the operations which are hidden behind the actor based implementation of Blended 3. Essentially, the straight forward approach is to look at the messages the actor currently understands and translate them into corresponding methods on the interface."><meta data-react-helmet="true" property="og:description" content="The implementation of the ZIO version starts with defining an interface that resembles the operations which are hidden behind the actor based implementation of Blended 3. Essentially, the straight forward approach is to look at the messages the actor currently understands and translate them into corresponding methods on the interface."><meta data-react-helmet="true" property="og:url" content="https://blended-zio.github.io/blended-zio/blended-zio/docs/jmx/servicemetrics"><link data-react-helmet="true" rel="shortcut icon" href="/blended-zio/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blended-zio.github.io/blended-zio/blended-zio/docs/jmx/servicemetrics"><link rel="stylesheet" href="/blended-zio/styles.b0c1b4e5.css">
<link rel="preload" href="/blended-zio/styles.da6d526b.js" as="script">
<link rel="preload" href="/blended-zio/runtime~main.92ab234a.js" as="script">
<link rel="preload" href="/blended-zio/main.1e30f61a.js" as="script">
<link rel="preload" href="/blended-zio/1.9a06b93b.js" as="script">
<link rel="preload" href="/blended-zio/2.a102c19c.js" as="script">
<link rel="preload" href="/blended-zio/54.dd637c66.js" as="script">
<link rel="preload" href="/blended-zio/55.9221783b.js" as="script">
<link rel="preload" href="/blended-zio/935f2afb.ed868d14.js" as="script">
<link rel="preload" href="/blended-zio/17896441.58f5d11b.js" as="script">
<link rel="preload" href="/blended-zio/e2548a61.2c095fe4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/blended-zio/"><img src="/blended-zio/img/Logos/svg/black_no_background.svg" alt="Blended ZIO" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blended-zio/img/Logos/svg/black_no_background.svg" alt="Blended ZIO" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blended-zio/docs/">Docs</a><a class="navbar__item navbar__link" href="/blended-zio/blog">Blog</a><a href="https://github.com/blended-zio/blended-zio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/blended-zio/"><img src="/blended-zio/img/Logos/svg/black_no_background.svg" alt="Blended ZIO" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blended-zio/img/Logos/svg/black_no_background.svg" alt="Blended ZIO" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blended-zio/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blended-zio/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/blended-zio/blended-zio" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blended-zio/docs/">Blended Use Cases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/blended-zio/docs/container">Service based containers</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Modules</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/blended-zio/docs/core/index">Blended ZIO Core</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">JMX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/blended-zio/docs/jmx/index">JMX Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/blended-zio/docs/jmx/mbeanserver">A simple MBean Server Facade</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/blended-zio/docs/jmx/mbeanpublisher">MBean Publisher</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/blended-zio/docs/jmx/servicemetrics">Service Metrics</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/blended-zio/docs/streams/index">Blended ZIO Streams</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Service Metrics</h1></header><div class="markdown"><p>The implementation of the ZIO version starts with defining an interface that resembles the operations which are <em>hidden</em> behind the actor based implementation of <em>Blended 3</em>. Essentially, the straight forward approach is to look at the messages the actor currently understands and translate them into corresponding methods on the interface.</p><p>The actor currently understands 3 messages:</p><ul><li>start service invocation</li><li>complete invocation with success</li><li>complete invocation with error</li></ul><p>In addition to this we would like to retrieve the current list of active invocations and also the current collected summaries.</p><p>This leads to the following interface definition:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">  trait Service {</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    /**</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * Start to track a service invocation for a given start event.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * If a tracker for that id is still active, a [[ServiceMetricsException]] will be returned.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * Otherwise, an updated ServiceTrackingEntry will be returned.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * @param start The start event containing the details of the service invocation to be tracked</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     */</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def start(start: ServiceInvocationStarted): ZIO[Any, ServiceMetricsException, ServiceTrackingEntry]</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    /**</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * Signal the successful completion of a service invocation. The invocation is referenced by</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * the id of a corresponding call to [[start]]. If the invocation cannot be found, a</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * [[ServiceMetricsException]] will be returned</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * @param s The completion event for the service invocation</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     */</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def complete(s: ServiceInvocationCompleted): ZIO[Any, ServiceMetricsException, ServiceTrackingEntry]</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    /**</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * Signal the successful completion of a service invocation. The invocation is referenced by</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * the id of a corresponding call to [[start]]. If the invocation cannot be found, a</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * [[ServiceMetricsException]] will be returned.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * @param f The completion event for the service invocation</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     */</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def failed(f: ServiceInvocationFailed): ZIO[Any, ServiceMetricsException, ServiceTrackingEntry]</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    /**</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * Get the list of service invocation ids which are currently active.</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     */</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def active: ZIO[Any, Nothing, List[String]]</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    /**</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     * Get the current Map of summaries recorded by the Service tracker</span></div><div class="token-line" style="color:#403f53"><span class="token plain">     */</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def summaries: ZIO[Any, Nothing, Map[String, ServiceTrackingEntry]]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note, that all methods on the interface return ZIO effects.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="implementation-notes"></a>Implementation notes<a class="hash-link" href="#implementation-notes" title="Direct link to heading">#</a></h2><p>The implementation needs to maintain a list currently active of service invocation invocations, so that we can properly close them with a failed or completed event. Furthermore, we need to keep track of the invocation summaries so that we can keep track of the grouped invocations statistics.</p><p>Inspired by <a href="https://scalac.io/how-to-write-a-completely-lock-free-concurrent-lru-cache-with-zio-stm/" target="_blank" rel="noopener noreferrer">this article</a> about implementing a concurrent LRU cache we have decided to implement a ConcurrentServiceTracker using STM References under the covers:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">final class ConcurrentInvocationTracker private (</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val running: TMap[String, ServiceInvocationStarted],</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val summary: TMap[String, ServiceTrackingEntry]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">) { self =&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>First of all we need a couple of helpers helping us to manipulate the two maps. The names of the helper functions speak for themselves and all of them use STM under the covers, so that we can compose them to implement the actual business functions and finally call commit in order to end up with a ZIO effect as result.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">  private val updStarted: ServiceTrackingEntry =&gt; ServiceTrackingEntry =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    e =&gt; e.copy(inflight = e.inflight + 1)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  private val updFailed: Long =&gt; ServiceTrackingEntry =&gt; ServiceTrackingEntry = started =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    orig =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      orig.copy(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        lastFailed = Some(System.currentTimeMillis()),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        failed = orig.failed.record(System.currentTimeMillis() - started),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        inflight = orig.inflight - 1</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      )</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  private val updCompleted: Long =&gt; ServiceTrackingEntry =&gt; ServiceTrackingEntry = started =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    orig =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      orig.copy(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        success = orig.success.record(System.currentTimeMillis() - started),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        inflight = orig.inflight - 1</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      )</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  private def getExistingSummary(sumId: String): STM[ServiceMetricsException, ServiceTrackingEntry] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    STM.require(new ServiceSummaryNotFoundException(sumId))(self.summary.get(sumId))</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  private def getExistingActive(id: String): STM[ServiceMetricsException, ServiceInvocationStarted] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    STM.require(new ServiceInvocationNotFoundException(id))(self.running.get(id))</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  private def addSummary(evt: ServiceInvocationStarted): STM[Nothing, ServiceTrackingEntry] = for {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    entry &lt;- STM.succeed(ServiceTrackingEntry(evt.summarizeId))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _     &lt;- self.summary.put(evt.summarizeId, entry)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  } yield (entry)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  private def getOrCreateSummary(evt: ServiceInvocationStarted): STM[Nothing, ServiceTrackingEntry] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    self.summary.get(evt.summarizeId).flatMap {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      case Some(e) =&gt; STM.succeed(e)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      case None    =&gt; addSummary(evt)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Within the implementation the <code>update</code>method is responsible for recording the completion or failure for a given invocation id. Therefore we need to determine the currently active entry from our active map and also the existing summary. Note that if everything works as designed, the summary mst already exist at this point in time. However, either of these calls may fail with a ServiceMetricsException, which is reflected in the method signature.</p><p>Once we have looked up the entries, we can simply perform the required update and we are done.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">  private def update(id: String, success: Boolean): ZIO[Any, ServiceMetricsException, ServiceTrackingEntry] = (for {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    act   &lt;- getExistingActive(id)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    sumId  = act.summarizeId</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    entry &lt;- getExistingSummary(sumId)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    upd    = if (success) updCompleted(act.timestamp)(entry) else updFailed(act.timestamp)(entry)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _     &lt;- self.summary.put(sumId, upd)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _     &lt;- self.running.delete(id)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  } yield (upd)).commit</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>start</code> method is very similar. We are using <code>getExistingActive(evt.id).flip</code>, so that having an already defined entry for the given id will be considered an exception. Also, in this case we are using <code>getOrCreateSummary(evt)</code> to ensure that the summary map definitely has an entry.</p><p>Finally, we are using <code>mapError</code> to create the proper exception indicating the a service with the same id was already active.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">  def start(evt: ServiceInvocationStarted): ZIO[Any, ServiceMetricsException, ServiceTrackingEntry] = (for {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // Using the flip will turn an existing invocation into the error type, so that we can handle that</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // at the end with mapError</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _     &lt;- getExistingActive(evt.id).flip</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _     &lt;- self.running.put(evt.id, evt)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // make sure we do have a summary entry in our summary map</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    entry &lt;- getOrCreateSummary(evt)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    // Record the service start</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    upd    = updStarted(entry)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    _     &lt;- self.summary.put(evt.summarizeId, upd)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  } yield (upd)).commit.mapError(_ =&gt; new ServiceAlreadyStartedException(evt))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>Testing is done with <a href="https://zio.dev/docs/howto/howto_test_effects" target="_blank" rel="noopener noreferrer">zio-test</a> and is fairly straight forward. The tests provide the <code>live</code> service via <code>ZLayer</code> and then use the interface methods to call the service and verify the result with assertions.</p><p>For example, the test to verify that a successful service completion is implemented as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-scala codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">  private val recordComplete = testM(&quot;record a service completion correctly&quot;) {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    for {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      tracker &lt;- ZIO.service[ServiceMetrics.Service]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      s       &lt;- start</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      c       &lt;- completed(s)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      old     &lt;- tracker.summaries</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      e       &lt;- ZIO.effectTotal(old.getOrElse(s.summarizeId, ServiceTrackingEntry(s.summarizeId)))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      _       &lt;- tracker.start(s)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      _       &lt;- tracker.complete(c)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      sum     &lt;- tracker.summaries</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    } yield assert(sum(s.summarizeId).success.count)(isGreaterThanEqualTo(e.success.count))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blended-zio/docs/jmx/mbeanpublisher"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« MBean Publisher</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blended-zio/docs/streams/index"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Blended ZIO Streams Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#implementation-notes" class="table-of-contents__link">Implementation notes</a></li><li><a href="#testing" class="table-of-contents__link">Testing</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">About</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blended-zio/docs/andreas">Andreas Gies</a></li><li class="footer__item"><a class="footer__link-item" href="/blended-zio/docs/legal">Legal</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/jaHWkWqn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://github.com/blended-zio/blended-zio/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blended-zio/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/blended-zio/blended-zio" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Way of Quality GmbH - Built with <a href="https://v2.docusaurus.io/">Docusaurus v2</a></div></div></div></footer></div>
<script src="/blended-zio/styles.da6d526b.js"></script>
<script src="/blended-zio/runtime~main.92ab234a.js"></script>
<script src="/blended-zio/main.1e30f61a.js"></script>
<script src="/blended-zio/1.9a06b93b.js"></script>
<script src="/blended-zio/2.a102c19c.js"></script>
<script src="/blended-zio/54.dd637c66.js"></script>
<script src="/blended-zio/55.9221783b.js"></script>
<script src="/blended-zio/935f2afb.ed868d14.js"></script>
<script src="/blended-zio/17896441.58f5d11b.js"></script>
<script src="/blended-zio/e2548a61.2c095fe4.js"></script>
</body>
</html>